/*===================================================================================================================
 * @name: bPopup
 * @type: jQuery
 * @author: (c) Bjoern Klinggaard - @bklinggaard
 * @demo: http://dinbror.dk/bpopup
 * @version: 0.11.0
 * @requires jQuery 1.4.3
 *==================================================================================================================*/
!function(j){"use strict";j.fn.bPopup=function(o,t){j.isFunction(o)&&(t=o,o=null);var i=j.extend({},j.fn.bPopup.defaults,o);i.scrollBar||j("html").css("overflow","hidden");var n,a,l,s,d,e,r,c,u,p,f,h=this,w=j(document),b=window,m=j(b),g=D(),C=L(),k="__b-popup",y=/OS 6(_\d)+/i.test(navigator.userAgent),T=200,P=0;return h.close=function(){x()},h.reposition=function(o){v(o)},h.each(function(){j(this).data("bPopup")||(H(i.onOpen),P=(m.data("bPopup")||0)+1,n=k+P+"__",l="auto"!==i.position[1],s="auto"!==i.position[0],d="fixed"===i.positionStyle,c=h.outerHeight(!0),u=h.outerWidth(!0),(i.loadUrl?function(){switch(i.contentContainer=j(i.contentContainer||h),i.content){case"iframe":var o=j('<iframe class="b-iframe" '+i.iframeAttr+"></iframe>");o.appendTo(i.contentContainer),c=h.outerHeight(!0),u=h.outerWidth(!0),_(),o.attr("src",i.loadUrl),H(i.loadCallback);break;case"image":_(),j("<img />").load(function(){H(i.loadCallback),B(j(this))}).attr("src",i.loadUrl).hide().appendTo(i.contentContainer);break;default:_(),j('<div class="b-ajax-wrapper"></div>').load(i.loadUrl,i.loadData,function(o,t,n){H(i.loadCallback,t),B(j(this))}).hide().appendTo(i.contentContainer)}}:_)())});function _(){i.modal&&j('<div class="b-modal '+n+'"></div>').css({backgroundColor:i.modalColor,position:"fixed",top:0,right:0,bottom:0,left:0,opacity:0,zIndex:i.zIndex+P}).appendTo(i.appendTo).fadeTo(i.speed,i.opacity),W(),h.data("bPopup",i).data("id",n).css({left:"slideIn"==i.transition||"slideBack"==i.transition?"slideBack"==i.transition?w.scrollLeft()+C:-1*(r+u):S(!(!i.follow[0]&&s||d)),position:i.positionStyle||"absolute",top:"slideDown"==i.transition||"slideUp"==i.transition?"slideUp"==i.transition?w.scrollTop()+g:e+-1*c:z(!(!i.follow[1]&&l||d)),"z-index":i.zIndex+P+1}).each(function(){i.appending&&j(this).appendTo(i.appendTo)}),U(!0)}function x(){return i.modal&&j(".b-modal."+h.data("id")).fadeTo(i.speed,0,function(){j(this).remove()}),function(){i.scrollBar||j("html").css("overflow","auto");j(".b-modal."+n).unbind("click"),w.unbind("keydown."+n),m.unbind("."+n).data("bPopup",0<m.data("bPopup")-1?m.data("bPopup")-1:null),h.undelegate(".bClose, ."+i.closeClass,"click."+n,x).data("bPopup",null)}(),clearTimeout(f),U(),!1}function v(t){g=D(),C=L(),((a=A()).x||a.y)&&(clearTimeout(p),p=setTimeout(function(){W(),t=t||i.followSpeed;var o={};a.x&&(o.left=i.follow[0]?S(!0):"auto"),a.y&&(o.top=i.follow[1]?z(!0):"auto"),h.dequeue().each(function(){d?j(this).css({left:r,top:e}):j(this).animate(o,t,i.followEasing)})},50))}function B(o){var t=o.width(),n=o.height(),e={};i.contentContainer.css({height:n,width:t}),n>=h.height()&&(e.height=h.height()),t>=h.width()&&(e.width=h.width()),c=h.outerHeight(!0),u=h.outerWidth(!0),W(),i.contentContainer.css({height:"auto",width:"auto"}),e.left=S(!(!i.follow[0]&&s||d)),e.top=z(!(!i.follow[1]&&l||d)),h.animate(e,250,function(){o.show(),a=A()})}function U(t){switch(t?i.transition:i.transitionClose||i.transition){case"slideIn":o({left:t?S(!(!i.follow[0]&&s||d)):w.scrollLeft()-(u||h.outerWidth(!0))-T});break;case"slideBack":o({left:t?S(!(!i.follow[0]&&s||d)):w.scrollLeft()+C+T});break;case"slideDown":o({top:t?z(!(!i.follow[1]&&l||d)):w.scrollTop()-(c||h.outerHeight(!0))-T});break;case"slideUp":o({top:t?z(!(!i.follow[1]&&l||d)):w.scrollTop()+g+T});break;default:h.stop().fadeTo(i.speed,t?1:0,function(){I(t)})}function o(o){h.css({display:"block",opacity:1}).animate(o,i.speed,i.easing,function(){I(t)})}}function I(o){o?(m.data("bPopup",P),h.delegate(".bClose, ."+i.closeClass,"click."+n,x),i.modalClose&&j(".b-modal."+n).css("cursor","pointer").bind("click",x),y||!i.follow[0]&&!i.follow[1]||m.bind("scroll."+n,function(){if(a.x||a.y){var o={};a.x&&(o.left=i.follow[0]?S(!d):"auto"),a.y&&(o.top=i.follow[1]?z(!d):"auto"),h.dequeue().animate(o,i.followSpeed,i.followEasing)}}).bind("resize."+n,function(){v()}),i.escClose&&w.bind("keydown."+n,function(o){27==o.which&&x()}),H(t),i.autoClose&&(f=setTimeout(x,i.autoClose))):(h.hide(),H(i.onClose),window.__afterBPopup&&j.isFunction(window.__afterBPopup)&&window.__afterBPopup.apply(window,window.__afterBPopupArgs),window.__afterBPopup=window.__afterBPopupArgs=null,i.loadUrl&&(i.contentContainer.empty(),h.css({height:"auto",width:"auto"})))}function S(o){return o?r+w.scrollLeft():r}function z(o){return o?e+w.scrollTop():e}function H(o,t){j.isFunction(o)&&o.call(h,t)}function W(){e=l?i.position[1]:Math.max(0,(g-h.outerHeight(!0))/2-i.amsl),r=s?i.position[0]:(C-h.outerWidth(!0))/2,a=A()}function A(){return{x:C>h.outerWidth(!0),y:g>h.outerHeight(!0)}}function D(){return m.height()}function L(){return m.width()}},j.fn.bPopup.defaults={amsl:50,appending:!0,appendTo:"body",autoClose:!1,closeClass:"b-close",content:"ajax",contentContainer:!1,easing:"swing",escClose:!0,follow:[!0,!0],followEasing:"swing",followSpeed:500,iframeAttr:'scrolling="no" frameborder="0"',loadCallback:!1,loadData:!1,loadUrl:!1,modal:!0,modalClose:!0,modalColor:"#000",onClose:!1,onOpen:!1,opacity:.7,position:["auto","auto"],positionStyle:"absolute",scrollBar:!0,speed:250,transition:"fadeIn",transitionClose:!1,zIndex:9997}}(jQuery);
